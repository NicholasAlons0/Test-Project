attach(Household_Pulse_data)
summary(Household_Pulse_data)
detach()
#REGSSION FOR FIRST QUESITION
regressions <- lm(RECVDVACC ~ EEDUC*REGION)
summary(regressions)

regressions <- lm(vaccine ~ education*regions)
summary(regressions)
  



question1 <-lm(as.numeric(EEDUC)~ RECVDVACC* REGION)
summary(question1)
anova(question1)
Anova(question1)
TukeyHSD(question1)
aov((EEDUC ~ RECVDVACC + REGION))


# run regions separately

# People with an advance degree, from the south region are not as significant because the 
# t value is to close to zero, the p value is above the level of significance.
# Thus, I fail to reject the null hypothesis for people in the south with an advance 
# degree have and conclude there is no significant relationship between getting the vaccine and
# and people in the south with an advance degree.
# Compared to people in with education high school in region west, that have a t-stat that 
# is far away from  zero and a p_value below the level of significance, I can say with 99%
# confidence that we reject th null hypothesis that there is no relationship between getting the 
#vaccine and are in favor of the alternative hypothesis that there is a relationship.
# the same would apply, to the variables that have no significance stars, we fail to reject the null
# hypotheses that there is no relationship. whereas, all the variables that have at least one star,
# we reject the null hypothesis depending the level of significance

regression11<-lm(as.numeric(RECVDVACC)~ EEDUC* GENID_DESCRIBE)
summary(regression11)

genderid <- as.numeric(GENID_DESCRIBE)
regressions3 <- lm(genderid ~ EEDUC*RECVDVACC)
summary(regressions3)

# In the regression, the Null Hypothesis is that there is no significant difference or relationship between the genderID
# and educations and people the receive the vaccine,
# while the alternative hypothesis states there is a significant difference or relationship.
# The t-stats, p-values and confidence intervals of the someone with advance education,
# that have received the vaccine is significant because of the p value that is 0.0056, which
# below the level of significance and has a t-stats of 2.767, which is decently far from 0,
#therefore we reject the null hypothesis that there is no relationship and conclude that
# there is a relationship between genderID and people advance education, that have received the vaccine.
# for the ones with no significance, like somecollege and no covid vaccine, 
# we fail to reject the null hypothesis and conclude there is no relationship between genderID AND 
# education level or people that not get the covid vaccine.


#NUMBER 3

#so I will make Hispanic into a numeric in order to subset it.
summary(Household_Pulse_data$RHISPANIC)
length(Household_Pulse_data$RHISPANIC)



# I also changed the list of variables to numeric so that I can potentially use in the analysis. 
Household_Pulse_data$RHISPANIC <- as.numeric(Household_Pulse_data$RHISPANIC)
Household_Pulse_data$RRACE <- as.numeric(Household_Pulse_data$RRACE)
Household_Pulse_data$EEDUC <- as.numeric(Household_Pulse_data$EEDUC)
Household_Pulse_data$RECVDVACC <- as.numeric(Household_Pulse_data$RECVDVACC)
Household_Pulse_data$INCOME <- as.numeric(Household_Pulse_data$INCOME)
Household_Pulse_data$ANXIOUS <- as.numeric(Household_Pulse_data$ANXIOUS)
Household_Pulse_data$REGION <- as.numeric(Household_Pulse_data$REGION)
Household_Pulse_data$GENID_DESCRIBE <- as.numeric(Household_Pulse_data$GENID_DESCRIBE)
Household_Pulse_data$PRIVHLTH <- as.numeric(Household_Pulse_data$PRIVHLTH)
Household_Pulse_data$PUBHLTH <- as.numeric(Household_Pulse_data$PUBHLTH)

Household_Pulse_data$SEXUAL_ORIENTATION <- as.numeric(Household_Pulse_data$SEXUAL_ORIENTATION)
Household_Pulse_data$ENROLLNONE <- as.numeric(Household_Pulse_data$ENROLLNONE)
Household_Pulse_data$KIDS_LT5Y <- as.numeric(Household_Pulse_data$KIDS_LT5Y)
Household_Pulse_data$EST_ST <- as.numeric(Household_Pulse_data$EST_ST)

#First, just to see if we have separate subgroups
list(Household_Pulse_data$INCOME)
list(hispanic_subgroup$INCOME)
# Seems like we do.
summary(Household_Pulse_data)
summary(hispanic_subgroup)
# When comparing the summaries of the subgroup and sample, we see that hispanic_subgroup 
# is indeed a subgroup of just Hispanics. This subgroup is interesting because
# one could explore differences between of household income from the subgroup and the sample.
# Additionally, it might be interesting to go into the analysis with the assumption that 
# Hispanics will have a lower overall household income compared to the sample. 

# Exploring where subgroup differs from sample.
 hispanic_income <- (Household_Pulse_data$RHISPANIC == 2) & (Household_Pulse_data$INCOME)
regression12 <-  lm(Household_Pulse_data$INCOME ~ hispanic_income)
summary(regression12)
confint(regression12)

anova(regression12)
#same as:
summary(aov(Household_Pulse_data$INCOME ~ hispanic_income))

# When checking for summary, we are testing to see if the subgroup of Hispanics does differ from the entire sample. 
# The Null Hypothesis states there is no significant difference between the dependent
# and independent variables, while the alternative hypothesis states there is a significant difference.
# The t-stat is -24.75, p-values is 2e-16, which is less than the level of significance, therefore the 
# subgroup of Hispanics are statistically significant. Thus, we reject the null hypothesis that there 
# is no difference and deem there is sufficient evidence to support that the coefficients are different
# from the sample. Additionally, the coefficient falls within the confidence interval at a confidence level of 95%,
# ranging from -0.8334076 -0.7111021, meaning the interval is expected to cover the true population proportion of 
# Hispanics 95% of the time. Since the coefficient of the regression falls within the interval, we are 95% confident
# the coefficient represents the true mean of Hispanics, showing that Hispanics have less income than the rest of the sample.
# For the anova test, the null hypothesis for anova is that the means are equal to each other, while the 
# alternative hypothesis is that the means differ. Since a p-value of 2.2e-16 is less than a level of 
# significance of 0.001, we reject null in favor of the alternative hypothesis that not all means are equal.

#RESIDUALS MEANING????
#RESIDUALS MEANING????
#RESIDUALS MEANING????

# However, anova the residual sum of squares is 393666, since it is vary big this might indicate it is a
# poor fit for this data. Also, low multiple R-^2, may affect variation significance...
#??? 
# Thus the mean incomes of the Hispanics is different compared to the rest of the of the sample.




#SUBSET
# The second way I interpreted to run the regression was using a direct subset of Hispanics.
# I created the subset of just Hispanics, by changing the the factor to numeric
# then sub-setting the data.
#IGNOR RED, STILL RUNS....
hispanic_subgroup <- subset(Household_Pulse_data, Household_Pulse_data$RHISPANIC == 2) 

#For the regression, we divide the different income levels, with people making less than $25,000 the lowest
#and people that make at most $199,999 the highest. While intentionally leaving out the group that made over $200,000 
#because adding all the different ranges of a single dummy would make one in the regression an NA.

incomeless25 <-  hispanic_subgroup$INCOME == 1
income25_35 <- hispanic_subgroup$INCOME == 2
income35_45 <- hispanic_subgroup$INCOME == 3
income50_75 <- hispanic_subgroup$INCOME == 4
income75_99 <- hispanic_subgroup$INCOME == 5
income100_149 <- hispanic_subgroup$INCOME == 6
income150_199 <- hispanic_subgroup$INCOME == 7

# I wanted to test whether there is a relationship between Hispanics' health insurance and their income level, so 
# the dependent variable is private health insurance, while the independents are the different income levels.
regression <- lm(hispanic_subgroup$PRIVHLTH ~ incomeless25 + income25_35 + income35_45 + income50_75 + 
                   income75_99 + income100_149 +income150_199 )
summary(regression)
stargazer(regression, type = "text")
confint(regression)
anova(regression)
TukeyHSD(aov(regression))
# We will analyze the summary at a 99% level of confidence.
# The null hypothesis for summary states there is no difference from Hispanics with private health insurance to the 
# different levels of income. The regression shows Hispanics that make more than $75,000 have are not significantly 
# different. Since the lowest p-value is 0.50819, which is well above the level of significance. So we fail to reject 
# the null hypothesis and conclude there is no significant difference between those with private health insurance and
# those that are wealthy. Which makes sense due to the fact that wealthy Hispanics are more likely to afford private
# health insurance. On the other hand, Hispanics that have an income of $74,999 or lower are significantly
# different because the highest p-values, which is 0.00134, is well below the level of significance.
# So, we reject the null hypothesis in favor of the alternative hypothesis, stating there is a significant 
# difference between Hispanics that own private health insurance and people with lower income. 
# Now we will analyze the ANOVA test at a level of significance of 0.001.
# The null hypothesis for anova is that the means are equal to each other,
# while the alternative hypothesis is that the means differ.
# For Hispanics that make less than $75,000 we reject the null that means are equal, in favor
# of the alternative hypothesis that the means are different for the those that 
# have private health insurance because the smallest F-value is 21.0398, and the largest p-value is 4.584e-06.
# However, for people that make more than 75,000 we fail to reject the null hypothesis and deem there 
# is no difference in means between people that make more than 75,000 and those that have private health insurance
# because the largest f-value is 0.8540 and the smallest p-value is 0.3555.


#TRY TO INTERPRET RESIDUALS!!!!!

#Now For a KNN of different education levels
# we created different variables for the educational levels of our subgroup of Hispanics.
less_highschool <- hispanic_subgroup$EEDUC == 1
some_highschool <- hispanic_subgroup$EEDUC == 2
highschool <- hispanic_subgroup$EEDUC == 3
some_college <- hispanic_subgroup$EEDUC == 4
associates <- hispanic_subgroup$EEDUC == 5
bacholers <-   hispanic_subgroup$EEDUC == 6
graduate <- hispanic_subgroup$EEDUC == 7


educ_indx <- factor((less_highschool + 2*some_highschool + 3*highschool + 4*some_college), levels=c(1,2,3,4),labels = c("Less HS","Some HS","HS","Some College"))
norm_varb <- function(X_in) { (X_in - min(X_in, na.rm = TRUE))/( max(X_in, na.rm = TRUE) - min(X_in, na.rm = TRUE) )
}

norm_income <- norm_varb(hispanic_subgroup$INCOME)
norm_private_insurance <- norm_varb(hispanic_subgroup$PRIVHLTH)
data_use_prelim <- data.frame(norm_income,norm_private_insurance)
good_obs_data_use <- complete.cases(data_use_prelim,educ_indx)
dat_use <- subset(data_use_prelim,good_obs_data_use)
y_use <- subset(educ_indx,good_obs_data_use)
set.seed(1)
NN_obs <- sum(good_obs_data_use == 1)
select1 <- (runif(NN_obs) < 0.9)
train_data <- subset(dat_use,select1)
test_data <- subset(dat_use,(!select1))
cl_data <- y_use[select1]
true_data <- y_use[!select1]
summary(cl_data)
prop.table(summary(cl_data))
summary(train_data)
require(class)
for (indx in seq(1, 9, by= 2)) {
  pred_borough <- knn(train_data, test_data, cl_data, k = indx, l = 0, prob = FALSE, use.all = TRUE)
  num_correct_labels <- sum(pred_borough == true_data)
  correct_rate <- num_correct_labels/length(true_data)
  print(c(indx,correct_rate))
}
#THIS WORKKKSSS!!!!!!!!!!
# When attempting to predict different educational levels, use create dummies from less than 
# high school to some college education. Then, use use the norm variables of Income and Private
# health insurance to predict the listed educational levels. Using 
# this KNN model, we can predict the first nearest neighbor with a 55 percent accuracy.
cl_data_n <- as.numeric(cl_data)
model_ols1 <- lm(cl_data_n ~ train_data$norm_income + train_data$norm_private_insurance)         
y_hat <- fitted.values(model_ols1)
cl_data_n1 <- as.numeric(cl_data_n == 1)
model_ols_v1 <- lm(cl_data_n1 ~ train_data$norm_income + train_data$norm_private_insurance)
y_hat_v1 <- fitted.values(model_ols_v1)
mean(y_hat_v1[cl_data_n1 == 1])
cl_data_n1 <- as.numeric(cl_data_n == 2)
model_ols_v1 <- lm(cl_data_n1 ~ train_data$norm_income + train_data$norm_private_insurance)
y_hat_v1 <- fitted.values(model_ols_v1)
mean(y_hat_v1[cl_data_n1 == 1])
cl_data_n1 <- as.numeric(cl_data_n == 3)
model_ols_v1 <- lm( cl_data_n1 ~ train_data$norm_income + train_data$norm_private_insurance)
y_hat_v1 <- fitted.values(model_ols_v1)
mean(y_hat_v1[cl_data_n1 == 1])
cl_data_n1 <- as.numeric(cl_data_n == 4)
model_ols_v1 <- lm(cl_data_n1 ~ train_data$norm_income + train_data$norm_private_insurance)
y_hat_v1 <- fitted.values(model_ols_v1)
mean(y_hat_v1[cl_data_n1 == 1])
# Using the OLS to predict the accuracy oh education levels is only worthwhile for those with
# some college education, with a 0.52% accuracy, however
# every other educational group has a poor accuracy.

#I used a regression, to test the levels of anxiety of wealthy Hispanics.
# For the dependent variable, we set it to Hispanics that make a $150,000-$199,999 income
# and the independent variables are the levels of anxiety.
no_anxious <- hispanic_subgroup$ANXIOUS == 1
some_anxious <- hispanic_subgroup$ANXIOUS == 2
very_anxious <- hispanic_subgroup$ANXIOUS == 3
extremely_anxious <- hispanic_subgroup$ANXIOUS == 4
regression1 <- lm(income150_199 ~ no_anxious + some_anxious + very_anxious + extremely_anxious )
summary(regression1)
anova(regression1) 

#sum of residuals squared??? important???
#fix wording

#Residuals are errors, sum of residuals squared is sum of errors

# Using ANOVA, for Hispanics that are not anxious, the p-value is 1.804e-15, which is below the level of 
# significance of 0.001, thus we reject the null hypothesis indicating conclude there the means for non-anxious
# Hispanics and Hispanics wealthy are different. To further prove this statement, we can observe the other levels 
# of anxiety. For the categories "some", "very" and "extremely" anxious, the lowest 0.1530 is p-value, which above 
# the level of significance of 0.001 thus we fail to reject the null hypothesis, indicating there is no difference
# in the means of wealthy people and those that have anxiety. Thus, I can conclude that wealthy Hispanics show that 
# they are anxious, what I believe to be more likely is that although wealthy Hispanics may face similar stress to others, 
# they may also face less social stigma regarding openness of anxiety. For example, in a poorer social groups 
# or even social class, one may be more likely to be ridiculed for discussing their anxieties,
# however someone that is wealthier will be surrounded by a higher social class, and thus have less 
# friends or colleagues that will ridicule them for the anxiety they are facing. Therefore, the anxiety levels 
# by wealthier people are higher in the data only because they are more likely to report their struggles. Nonetheless,
# I conclude that Hispanics from that wealth distribution are in fact anxious to some degree.



#do all the basics for the questions, and where is says impress me, go all out, create a bunch of different 
#subgroups, graphs, etc.


xtabs(~ INCOME + EVICT + REGION) 
# An interesting cross tabs is that
# People that have a higher income are less likely to get evicted, while people with 
# less income are more likely to get evicted.

educationsample <- Household_Pulse_data$EEDUC
summary(educationsample)
table(educationsample)
length(educationsample)

educationsubgroup <- hispanic_subgroup$EEDUC
summary(educationsubgroup)
table(educationsubgroup)
length(educationsubgroup)
# When compare the proportions from the sample and subgroup, we can see the difference in median,
# where the sample has both a greater mean and median than the sample does, indicating that
# Hispanics have a lower overall educational level compared to everyone in the sample.


# All of the work on this exam is my own, answered honestly as rules state.
# Name: Nicholas Alonso
#  Date: 10/22/2021















#if we want to use this, must change public health to numeric...
white_healthinurance <- (Household_Pulse_data$RRACE == 1) & (Household_Pulse_data$PUBHLTH)
black_healthinsurance <- (Household_Pulse_data$RRACE == 2) & (Household_Pulse_data$PUBHLTH)
white_private <- (Household_Pulse_data$RRACE == 1) & (Household_Pulse_data$PRIVHLTH)
black_private <- (Household_Pulse_data$RRACE == 2) & (Household_Pulse_data$PRIVHLTH)
health_insurance <- lm(Household_Pulse_data$PRIVHLTH ~   white_private + black_private)
summary(health_insurance)
xtabs
summary(xtabs(~ white_healthinurance + black_healthinsurance)) 


